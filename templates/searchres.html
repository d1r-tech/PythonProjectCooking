{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">
        üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "<span class="text-primary">{{ search_query }}</span>"
    </h2>

    {% if not current_user.is_authenticated %}
    <div class="alert alert-info mb-4" style="
        background: rgba(212, 165, 116, 0.1);
        border: 1px solid rgba(212, 165, 116, 0.3);
        border-radius: 10px;
        color: #333;
    ">
        <div class="d-flex align-items-center">
            <div style="font-size: 20px; margin-right: 10px;">üìù</div>
            <div>
                <strong>–í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å,</strong> —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!
            </div>
            <div class="ml-auto">
                <a href="{{ url_for('login') }}" class="btn btn-sm mr-2" style="
                    background: #D4A574;
                    color: white;
                    border: 1px solid rgba(212, 165, 116, 0.3);
                    border-radius: 8px;
                    padding: 5px 12px;
                ">
                    –í–æ–π—Ç–∏
                </a>
                <a href="{{ url_for('reqister') }}" class="btn btn-sm" style="
                    background: #28a745;
                    color: white;
                    border: 1px solid rgba(40, 167, 69, 0.3);
                    border-radius: 8px;
                    padding: 5px 12px;
                ">
                    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="alert alert-light mb-4" style="
        background: rgba(212, 165, 116, 0.05);
        border: 1px solid rgba(212, 165, 116, 0.2);
        border-radius: 10px;
    ">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <strong>–ù–∞–π–¥–µ–Ω–æ —Ä–µ—Ü–µ–ø—Ç–æ–≤:</strong> {{ recipes|length }}
                {% if selected_category %}
                    –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ <span class="badge" style="
                        background: rgba(212, 165, 116, 0.2);
                        color: #333;
                    ">{{ selected_category }}</span>
                {% endif %}
            </div>
            <div>
                <a href="/" class="btn btn-sm" style="
                    background: #D4A574;
                    color: white;
                    border: 1px solid rgba(212, 165, 116, 0.3);
                    border-radius: 8px;
                    padding: 5px 15px;
                ">
                    ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
                </a>
            </div>
        </div>
    </div>

    {% if recipes %}
        <div class="recipes">
            {% for recipe in recipes %}
            <div class="recipe-card card mb-3" style="
                border: 1px solid rgba(212, 165, 116, 0.3);
                border-radius: 12px;
                background: rgba(255, 255, 255, 0.9);
            ">
                <div class="card-body">
                    <h4 class="card-title">{{ recipe.title }}</h4>

                    <p class="card-text">
                        <small class="text-muted">
                            üìÅ <strong>{{ recipe.category }}</strong>
                            {% if recipe.cooking_time %}
                                ‚Ä¢ ‚è±Ô∏è {{ recipe.cooking_time }} –º–∏–Ω
                            {% endif %}
                        </small>
                    </p>

                   <p class="card-text">
                        <strong>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</strong><br>
                        {{ recipe.ingredients }}
                    </p>
                   <p class="card-text">
                        <strong>–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</strong><br>
                        {{ recipe.content | replace('\n', '<br>') | safe }}
                   </p>

                   <p class="card-text">
                        <strong>–ê–ª–ª–µ—Ä–≥–µ–Ω—ã:</strong>
                        {{ recipe.allergens|map(attribute='title')|join(', ') or '–Ω–µ—Ç' }}
                   </p>

                    <div class="recipe-actions">
                        <a href="/download_recipe/{{ recipe.id }}"
                           class="recipe-action-btn btn-download">
                            –°–∫–∞—á–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç
                        </a>

                        {% if current_user.is_authenticated %}
                            {% set fav_ids = [] %}
                            {% if current_user.favourite_recipes %}
                                {% for fav in current_user.favourite_recipes %}
                                    {% if fav.id %}
                                        {% set _ = fav_ids.append(fav.id) %}
                                    {% endif %}
                                {% endfor %}
                            {% endif %}

                            {% if recipe.id in fav_ids %}
                                <a href="/remove_from_favourites/{{ recipe.id }}"
                                   class="recipe-action-btn btn-remove-fav">
                                    –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                                </a>
                            {% else %}
                                <a href="/add_to_favourites/{{ recipe.id }}"
                                   class="recipe-action-btn btn-add-fav">
                                    –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                                </a>
                            {% endif %}
                        {% else %}
                            <button class="recipe-action-btn btn-disabled"
                                    onclick="showRegistrationAlert()"
                                    title="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">
                                 –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-warning" style="
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 25px;
        ">
            <h5 class="alert-heading"> –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5>
            <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É <strong>"{{ search_query }}"</strong> —Ä–µ—Ü–µ–ø—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
        </div>
    {% endif %}
</div>
<div id="registrationAlert" style="display: none; position: fixed; top: 20px; right: 20px; z-index: 10000;">
    <div style="
        background: #4CAF50;
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        font-size: 15px;
        font-weight: 500;
        animation: fadeSlide 4s ease-in-out;
        transition: opacity 0.8s ease;
    ">
        üìù <strong>–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</strong>
    </div>
</div>

<script>
function showRegistrationAlert() {
    const alert = document.getElementById('registrationAlert');
    alert.style.display = 'block';

    setTimeout(() => {
        alert.style.opacity = '0';
        setTimeout(() => {
            alert.style.display = 'none';
            alert.style.opacity = '1';
        }, 800);
    }, 3200);
}
</script>

<style>
@keyframes fadeSlide {
    0% {
        opacity: 0;
        transform: translateX(30px);
    }
    20% {
        opacity: 1;
        transform: translateX(0);
    }
    80% {
        opacity: 1;
        transform: translateX(0);
    }
    100% {
        opacity: 0;
        transform: translateX(30px);
    }
}
</style>
{% endblock %}