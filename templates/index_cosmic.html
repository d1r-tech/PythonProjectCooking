{% extends "base_cosmic.html" %}  <!-- –∏–ª–∏ "base_cosmic.html" –µ—Å–ª–∏ —Å–æ–∑–¥–∞–ª–∏ -->
{% block content %}
{% if not selected_category %}
<!-- ‚≠ê‚≠ê‚≠ê –ë–û–õ–¨–®–û–ô –ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –õ–û–ì–û–¢–ò–ü ‚≠ê‚≠ê‚≠ê -->
<div class="space-logo-container" style="max-width: 600px; margin: 20px auto 40px;">
  <div class="space-logo">
    <!-- –ü–ª–∞–Ω–µ—Ç–∞-—Ç–∞—Ä–µ–ª–∫–∞ -->
    <div class="planet-dish" style="width: 120px; height: 120px; margin: 0 auto 20px;">
      <div class="planet-surface">
        <div class="crater"></div>
        <div class="crater"></div>
        <div class="crater"></div>
      </div>
    </div>

    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
    <div class="logo-text">
      <h1 class="main-title" style="font-size: 2.5rem;">FOODHUB</h1>
      <p class="subtitle" style="font-size: 1rem;">Cosmic Cuisine Navigator</p>
      <div class="tagline" style="font-size: 0.9rem;">Explore the galaxy of flavors üöÄ</div>
    </div>
  </div>
</div>

<style>
.space-logo-container {
  text-align: center;
  padding: 30px;
  background: rgba(10, 14, 42, 0.3);
  border-radius: 20px;
  border: 1px solid rgba(74, 144, 226, 0.2);
  box-shadow: 0 0 30px rgba(0, 150, 255, 0.2);
}

.planet-dish {
  background: radial-gradient(circle at 30% 30%, #4a90e2, #2c3e50);
  border-radius: 50%;
  box-shadow:
    inset 0 -15px 30px rgba(0, 0, 0, 0.7),
    0 0 40px rgba(74, 144, 226, 0.6),
    0 0 0 6px rgba(255, 255, 255, 0.1);
  animation: rotate 60s infinite linear;
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.main-title {
  font-family: 'Orbitron', sans-serif;
  font-weight: 900;
  background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7);
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: gradient-shift 8s infinite alternate;
  letter-spacing: 2px;
}

@keyframes gradient-shift {
  0% { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}
</style>
<h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª —Ä–µ—Ü–µ–ø—Ç–æ–≤:</h2>
<div style="margin: 40px 0;">
    <div style="display: flex; flex-wrap: wrap; gap: 25px; justify-content: center;">
        <!-- 1. –ó–∞–≤—Ç—Ä–∞–∫–∏ -->
        <a href="/?category=–ó–∞–≤—Ç—Ä–∞–∫–∏"
           style="display: block !important; width: 300px !important; height: 100px !important;
                  background: url('/static/images/breakfast.jpg') center/cover no-repeat !important;
                  color: white !important; text-decoration: none !important; border-radius: 12px !important;
                  font-size: 18px !important; text-align: center !important; line-height: 100px !important;
                  text-shadow: 1px 1px 2px black !important; border: 2px solid rgba(255, 255, 255, 0.8) !important;
                  font-weight: bold !important; box-shadow: 0 8px 25px rgba(0, 150, 255, 0.3) !important;
                  position: relative !important; overflow: hidden !important;">
            <span style="position: relative; z-index: 2;">üåÖ –£—Ç—Ä–µ–Ω–Ω–∏–µ –ø–ª–∞–Ω–µ—Ç—ã ü™ê</span>
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 14, 42, 0.4); z-index: 1;"></div>
        </a>

        <!-- 2. –û—Å–Ω–æ–≤–Ω—ã–µ –±–ª—é–¥–∞ -->
        <a href="/?category=–û—Å–Ω–æ–≤–Ω—ã–µ –±–ª—é–¥–∞"
           style="display: block !important; width: 300px !important; height: 100px !important;
                  background: url('/static/images/hotdishes.jpg') center/cover no-repeat !important;
                  color: white !important; text-decoration: none !important; border-radius: 12px !important;
                  font-size: 18px !important; text-align: center !important; line-height: 100px !important;
                  text-shadow: 1px 1px 2px black !important; border: 2px solid rgba(255, 255, 255, 0.8) !important;
                  font-weight: bold !important; box-shadow: 0 8px 25px rgba(0, 150, 255, 0.3) !important;
                  position: relative !important; overflow: hidden !important;">
            <span style="position: relative; z-index: 2;">–û—Å–Ω–æ–≤–Ω—ã–µ –±–ª—é–¥–∞ üçõ</span>
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 14, 42, 0.4); z-index: 1;"></div>
        </a>

        <!-- 3. –î–µ—Å–µ—Ä—Ç—ã -->
        <a href="/?category=–î–µ—Å–µ—Ä—Ç—ã"
           style="display: block !important; width: 300px !important; height: 100px !important;
                  background: url('/static/images/desserts.jpg') center/cover no-repeat !important;
                  color: white !important; text-decoration: none !important; border-radius: 12px !important;
                  font-size: 18px !important; text-align: center !important; line-height: 100px !important;
                  text-shadow: 1px 1px 2px black !important; border: 2px solid rgba(255, 255, 255, 0.8) !important;
                  font-weight: bold !important; box-shadow: 0 8px 25px rgba(0, 150, 255, 0.3) !important;
                  position: relative !important; overflow: hidden !important;">
            <span style="position: relative; z-index: 2;">üç∞ –°–ª–∞–¥–∫–∏–µ —Å–æ–∑–≤–µ–∑–¥–∏—è ‚ú®</span>
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 14, 42, 0.4); z-index: 1;"></div>
        </a>

        <!-- 4. –°—É–ø—ã -->
        <a href="/?category=–°—É–ø—ã"
           style="display: block !important; width: 300px !important; height: 100px !important;
                  background: url('/static/images/soup.jpg') center/cover no-repeat !important;
                  color: white !important; text-decoration: none !important; border-radius: 12px !important;
                  font-size: 18px !important; text-align: center !important; line-height: 100px !important;
                  text-shadow: 1px 1px 2px black !important; border: 2px solid rgba(255, 255, 255, 0.8) !important;
                  font-weight: bold !important; box-shadow: 0 8px 25px rgba(0, 150, 255, 0.3) !important;
                  position: relative !important; overflow: hidden !important;">
            <span style="position: relative; z-index: 2;">ü•£ –ì—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—É–ø—ã ü•£</span>
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 14, 42, 0.4); z-index: 1;"></div>
        </a>

        <!-- 5. –ù–∞–ø–∏—Ç–∫–∏ -->
        <a href="/?category=–ù–∞–ø–∏—Ç–∫–∏"
           style="display: block !important; width: 300px !important; height: 100px !important;
                  background: url('/static/images/drinks.jpg') center/cover no-repeat !important;
                  color: white !important; text-decoration: none !important; border-radius: 12px !important;
                  font-size: 18px !important; text-align: center !important; line-height: 100px !important;
                  text-shadow: 1px 1px 2px black !important; border: 2px solid rgba(255, 255, 255, 0.8) !important;
                  font-weight: bold !important; box-shadow: 0 8px 25px rgba(0, 150, 255, 0.3) !important;
                  position: relative !important; overflow: hidden !important;">
            <span style="position: relative; z-index: 2;">üöÄ –ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–∏—Ç–∫–∏ üöÄ</span>
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(10, 14, 42, 0.4); z-index: 1;"></div>
        </a>
    </div>
</div>

{% if selected_category %}
<!-- –ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –ö–û–ú–ü–ê–ö–¢–ù–´–ô –õ–û–ì–û–¢–ò–ü -->
<div style="margin-bottom: 20px; padding: 10px 0; border-bottom: 1px solid rgba(74, 144, 226, 0.2);">
    <a href="/" style="text-decoration: none; display: inline-flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(10, 14, 42, 0.9); border-radius: 20px; border: 1px solid rgba(74, 144, 226, 0.5); box-shadow: 0 0 10px rgba(0, 150, 255, 0.2);">
        <span style="font-size: 20px; animation: rotate 20s infinite linear;">ü™ê</span>
        <span style="font-family: 'Orbitron', sans-serif; font-weight: 700; color: white; font-size: 1rem; letter-spacing: 0.5px;">FOODHUB</span>
    </a>
</div>
{% endif %}
<!-- –ë–õ–û–ö –†–ï–¶–ï–ü–¢–û–í -->
<div class="recipes-section">
    <h3>{{ selected_category }}</h3>
    <div id="recipesList">
        {% if recipes %}
            {% for recipe in recipes %}
            <div class="recipe-card card mb-3" data-allergens="{{ recipe.allergens|map(attribute='id')|join(',') }}">
                <div class="card-body">
                    <h4 class="card-title">{{ recipe.title }}</h4>
                    <p class="card-text"><strong>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</strong> {{ recipe.ingredients }}</p>
                    <p class="card-text"><strong>–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</strong><br>{{ recipe.content | replace('\n', '<br>') | safe }}</p>
                    <p class="card-text"><strong>–ê–ª–ª–µ—Ä–≥–µ–Ω—ã:</strong>
                        {{ recipe.allergens|map(attribute='title')|join(', ') or '–Ω–µ—Ç' }}
                    </p>
                    <div class="favourite-section">
                        {% if current_user.is_authenticated %}
                            <a href="/add_to_favourites/{{ recipe.id }}" class="btn btn-outline-success btn-sm">
                                ‚òÜ –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                            </a>
                        {% else %}
                            <button class="btn btn-outline-secondary btn-sm"
                                onclick="showRegistrationAlert()"
                                title="–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">
                                    ‚òÜ –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤</p>
        {% endif %}
    </div>

    <div class="mt-3">
        <a href="/" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª–∞–º</a>
    </div>
</div>
{% endif %}
<!-- JavaScript –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
<script>
let selectedAllergens = [];

function applyFilter() {
    // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∞–ª–ª–µ—Ä–≥–µ–Ω—ã
    selectedAllergens = Array.from(document.querySelectorAll('.allergen-checkbox:checked'))
        .map(checkbox => checkbox.value);

    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∞–ª–ª–µ—Ä–≥–µ–Ω–æ–≤
    updateSelectedAllergensDisplay();

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
    filterRecipes();

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º dropdown
    $('.dropdown-menu').removeClass('show');
}

function clearFilter() {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã
    document.querySelectorAll('.allergen-checkbox').forEach(checkbox => {
        checkbox.checked = false;
    });

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä
    selectedAllergens = [];
    updateSelectedAllergensDisplay();
    filterRecipes();

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º dropdown
    $('.dropdown-menu').removeClass('show');
}

function updateSelectedAllergensDisplay() {
    const container = document.getElementById('selectedAllergens');
    if (selectedAllergens.length > 0) {
        container.innerHTML = '<strong>–ò—Å–∫–ª—é—á–µ–Ω—ã:</strong> ' + selectedAllergens.map(id => {
            const checkbox = document.querySelector(`.allergen-checkbox[value="${id}"]`);
            return checkbox ? checkbox.nextElementSibling.textContent : '';
        }).filter(name => name).join(', ');
    } else {
        container.innerHTML = '';
    }
}

function filterRecipes() {
    const recipeCards = document.querySelectorAll('.recipe-card');

    recipeCards.forEach(card => {
        const recipeAllergens = card.getAttribute('data-allergens').split(',').filter(id => id !== '');
        const hasSelectedAllergen = selectedAllergens.some(allergen => recipeAllergens.includes(allergen));

        card.style.display = hasSelectedAllergen ? 'none' : 'block';
    });
}
</script>
<!-- –ü–æ–ª–æ—Å–∫–∞-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–≤–µ—Ä—Ö—É -->
<div id="registrationAlert" style="display: none; position: fixed; top: 0; left: 0; width: 100%; z-index: 9999;">
    <div style="background: #e8e8e8; color: #333; padding: 15px 20px; border-bottom: 1px solid #ccc; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;">
            <div style="font-size: 16px; font-weight: 500;">
                üìù <strong>–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</strong>
            </div>
            <button onclick="hideRegistrationAlert()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">
                √ó
            </button>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
function showRegistrationAlert() {
    const alertDiv = document.getElementById('registrationAlert');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    alertDiv.style.display = 'block';

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        hideRegistrationAlert();
    }, 4000);
}

function hideRegistrationAlert() {
    document.getElementById('registrationAlert').style.display = 'none';
}
</script>
<style>
#registrationAlert {
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    from {
        transform: translateY(-100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}
/* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) */
#registrationAlert::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.3);
    z-index: -1;
    display: none;
}
</style>
{% endblock %}